<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme System Validation Test</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="navigation.js"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4">
        <h1 class="text-3xl font-bold text-center mb-8">Theme System Validation Test</h1>
        
        <!-- Current Status -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Current Status</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div>
                    <strong>Current Theme:</strong>
                    <span id="currentTheme" class="ml-2 px-2 py-1 bg-blue-100 rounded">-</span>
                </div>
                <div>
                    <strong>Current Page:</strong>
                    <span id="currentPage" class="ml-2 px-2 py-1 bg-green-100 rounded">-</span>
                </div>
                <div>
                    <strong>Base Page:</strong>
                    <span id="basePage" class="ml-2 px-2 py-1 bg-purple-100 rounded">-</span>
                </div>
            </div>
        </div>

        <!-- Theme Selection Test -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Theme Selection Test</h2>
            <div class="grid grid-cols-3 gap-4">
                <button onclick="testThemeSelection('classic')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Test Classic Theme
                </button>
                <button onclick="testThemeSelection('modern')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Test Modern Theme
                </button>
                <button onclick="testThemeSelection('elegant')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    Test Elegant Theme
                </button>
            </div>
        </div>

        <!-- Navigation Test -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Navigation Test</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="testNavigation('index.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Index
                </button>
                <button onclick="testNavigation('page3.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Page3
                </button>
                <button onclick="testNavigation('infovong1.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Info Vòng 1
                </button>
                <button onclick="testNavigation('infovong2.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Info Vòng 2
                </button>
                <button onclick="testNavigation('infovong3.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Info Vòng 3
                </button>
                <button onclick="testNavigation('thuchanh.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Thực hành
                </button>
                <button onclick="testNavigation('control.html')" class="bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                    → Settings
                </button>
                <button onclick="navigateToMainPage()" class="bg-orange-500 text-white px-3 py-2 rounded text-sm hover:bg-orange-600">
                    → Main Page
                </button>
            </div>
        </div>

        <!-- Theme Mapping Verification -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Theme Mapping Verification</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-3 py-2">Base Page</th>
                            <th class="border border-gray-300 px-3 py-2">Classic</th>
                            <th class="border border-gray-300 px-3 py-2">Modern</th>
                            <th class="border border-gray-300 px-3 py-2">Elegant</th>
                        </tr>
                    </thead>
                    <tbody id="mappingTable">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Test Results</h2>
            <div id="testResults" class="space-y-2 text-sm">
                <!-- Test results will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Update status display
        function updateStatus() {
            const theme = getSelectedTheme();
            const currentUrl = window.location.href;
            const fileName = currentUrl.substring(currentUrl.lastIndexOf('/') + 1);
            const basePageName = getCurrentBasePage();
            
            document.getElementById('currentTheme').textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
            document.getElementById('currentPage').textContent = fileName;
            document.getElementById('basePage').textContent = basePageName;
        }

        // Test theme selection
        function testThemeSelection(theme) {
            try {
                localStorage.setItem('selectedTheme', theme);
                updateStatus();
                logResult(`✓ Theme set to ${theme}`, 'success');
                
                // Test if theme mapping works
                const testPage = 'index.html';
                const themedPage = getThemedPage(testPage);
                logResult(`✓ ${testPage} maps to ${themedPage} in ${theme} theme`, 'info');
            } catch (error) {
                logResult(`✗ Error setting theme ${theme}: ${error.message}`, 'error');
            }
        }

        // Test navigation
        function testNavigation(pageName) {
            try {
                const currentTheme = getSelectedTheme();
                const themedPage = getThemedPage(pageName);
                logResult(`Navigation test: ${pageName} → ${themedPage} (${currentTheme} theme)`, 'info');
                
                // Actually navigate after a short delay to show the result
                setTimeout(() => {
                    navigateToPage(pageName);
                }, 1000);
            } catch (error) {
                logResult(`✗ Navigation error for ${pageName}: ${error.message}`, 'error');
            }
        }

        // Log test results
        function logResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultElement = document.createElement('div');
            resultElement.className = `p-2 rounded ${getResultClass(type)}`;
            resultElement.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(resultElement);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function getResultClass(type) {
            switch (type) {
                case 'success': return 'bg-green-100 text-green-800';
                case 'error': return 'bg-red-100 text-red-800';
                case 'warning': return 'bg-yellow-100 text-yellow-800';
                default: return 'bg-blue-100 text-blue-800';
            }
        }

        // Populate theme mapping table
        function populateMappingTable() {
            const tableBody = document.getElementById('mappingTable');
            const basePages = ['index.html', 'page3.html', 'infovong1.html', 'infovong2.html', 'infovong3.html', 'thuchanh.html'];
            
            basePages.forEach(basePage => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 px-3 py-2 font-medium">${basePage}</td>
                    <td class="border border-gray-300 px-3 py-2">${THEMES.classic[basePage] || basePage}</td>
                    <td class="border border-gray-300 px-3 py-2">${THEMES.modern[basePage] || basePage}</td>
                    <td class="border border-gray-300 px-3 py-2">${THEMES.elegant[basePage] || basePage}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Initialize test page
        function initializeTest() {
            updateStatus();
            populateMappingTable();
            logResult('Theme system validation test initialized', 'success');
            logResult(`Navigation system loaded: ${typeof navigateToPage === 'function' ? 'OK' : 'FAILED'}`, 
                     typeof navigateToPage === 'function' ? 'success' : 'error');
            logResult(`Theme configuration loaded: ${typeof THEMES === 'object' ? 'OK' : 'FAILED'}`, 
                     typeof THEMES === 'object' ? 'success' : 'error');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeTest);
        
        // Update status when storage changes
        window.addEventListener('storage', updateStatus);
    </script>
</body>
</html>
